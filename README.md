# ğŸ—ï¸ Smart Construction Monitor - Há»‡ Thá»‘ng GiÃ¡m SÃ¡t An ToÃ n CÃ´ng TrÃ¬nh

![PlatformIO](https://img.shields.io/badge/PlatformIO-Core-orange)
![ESP32](https://img.shields.io/badge/Device-ESP32-blue)
![Status](https://img.shields.io/badge/Status-Active-brightgreen)

## 1. MÃ´ táº£ dá»± Ã¡n (Project Description)

**Äáº·t váº¥n Ä‘á»:**
Hiá»‡n nay, cÃ¡c cÃ´ng trÃ¬nh xÃ¢y dá»±ng ngÃ y cÃ ng cÃ³ quy mÃ´ lá»›n vÃ  Ä‘á»™ cao phá»©c táº¡p, Ä‘i kÃ¨m vá»›i Ä‘Ã³ lÃ  nhá»¯ng rá»§i ro tiá»m áº©n vá» an toÃ n lao Ä‘á»™ng vÃ  cháº¥t lÆ°á»£ng káº¿t cáº¥u. CÃ¡c váº¥n Ä‘á» nhÆ° Ä‘á»™ rung láº¯c báº¥t thÆ°á»ng, giÃ n giÃ¡o bá»‹ nghiÃªng, hay viá»‡c kiá»ƒm soÃ¡t nhiá»‡t Ä‘á»™/Ä‘á»™ áº©m Ä‘á»ƒ báº£o dÆ°á»¡ng bÃª tÃ´ng cáº§n Ä‘Æ°á»£c giÃ¡m sÃ¡t cháº·t cháº½ 24/7. Tuy nhiÃªn, viá»‡c giÃ¡m sÃ¡t thá»§ cÃ´ng thÆ°á»ng tá»‘n kÃ©m vÃ  khÃ´ng bÃ¡o cÃ¡o ká»‹p thá»i khi sá»± cá»‘ xáº£y ra.

**Giáº£i phÃ¡p:**
Dá»± Ã¡n **Smart Construction Monitor** lÃ  thiáº¿t bá»‹ IoT nhá» gá»n Ä‘Æ°á»£c gáº¯n trá»±c tiáº¿p lÃªn cÃ¡c káº¿t cáº¥u (giÃ n giÃ¡o, cá»‘p pha, cá»™t trá»¥). Thiáº¿t bá»‹ giÃ¡m sÃ¡t liÃªn tá»¥c Ä‘á»™ nghiÃªng, Ä‘á»™ rung cháº¥n vÃ  mÃ´i trÆ°á»ng, gá»­i dá»¯ liá»‡u thá»i gian thá»±c vá» trung tÃ¢m Ä‘iá»u hÃ nh vÃ  phÃ¡t cáº£nh bÃ¡o ngay láº­p tá»©c giÃºp ngÄƒn cháº·n tai náº¡n.

## 2. Chá»©c nÄƒng chÃ­nh (Key Features)

- ğŸ“ **GiÃ¡m sÃ¡t káº¿t cáº¥u (Structural Health):**
  - **GÃ³c nghiÃªng (Tilt):** Äo Ä‘á»™ nghiÃªng trá»¥c X/Y Ä‘á»ƒ phÃ¡t hiá»‡n giÃ n giÃ¡o bá»‹ lá»‡ch tÃ¢m, lÃºn mÃ³ng.
  - **Äá»™ rung (Vibration):** PhÃ¡t hiá»‡n rung cháº¥n máº¡nh do giÃ³ bÃ£o hoáº·c mÃ¡y mÃ³c va Ä‘áº­p.
- ğŸŒ¡ï¸ **GiÃ¡m sÃ¡t mÃ´i trÆ°á»ng (Environment):**
  - **BÃª tÃ´ng:** GiÃ¡m sÃ¡t nhiá»‡t Ä‘á»™/Ä‘á»™ áº©m Ä‘á»ƒ Ä‘áº£m báº£o quy trÃ¬nh Ä‘Ã³ng ráº¯n (Curing) cá»§a bÃª tÃ´ng.
  - **An toÃ n:** PhÃ¡t hiá»‡n ná»“ng Ä‘á»™ khÃ­ Gas/KhÃ³i vÆ°á»£t ngÆ°á»¡ng cho phÃ©p.
- ğŸš¨ **Cáº£nh bÃ¡o Ä‘a táº§ng (Multi-level Alert):**
  - **Táº¡i chá»—:** CÃ²i Buzzer vÃ  ÄÃ¨n LED cáº£nh bÃ¡o ngay khi phÃ¡t hiá»‡n nguy hiá»ƒm.
  - **Tá»« xa:** Gá»­i tÃ­n hiá»‡u bÃ¡o Ä‘á»™ng vá» Dashboard Node-RED qua Internet.
- â˜ï¸ **GiÃ¡m sÃ¡t thá»±c (Real-time Monitoring):** Gá»­i gÃ³i tin dá»¯ liá»‡u má»—i **1 giÃ¢y/láº§n** giÃºp váº½ biá»ƒu Ä‘á»“ chi tiáº¿t vÃ  pháº£n á»©ng tá»©c thÃ¬.
- ğŸ“² **Cáº­p nháº­t khÃ´ng dÃ¢y (OTA):** Náº¡p firmware tá»« xa qua WiFi hoáº·c Bluetooth (BLE) mÃ  khÃ´ng cáº§n thÃ¡o thiáº¿t bá»‹.

## 3. Pháº§n cá»©ng sá»­ dá»¥ng (Hardware)

| ThÃ nh pháº§n | Chá»©c nÄƒng |
| :--- | :--- |
| **ESP32 (S3/S2)** | Vi Ä‘iá»u khiá»ƒn trung tÃ¢m, xá»­ lÃ½ WiFi/BLE |
| **MPU6050** | Cáº£m biáº¿n Gia tá»‘c & Con quay há»“i chuyá»ƒn (Äo nghiÃªng/rung) |
| **DHT11** | Cáº£m biáº¿n Nhiá»‡t Ä‘á»™, Äá»™ áº©m |
| **MQ-2** | Cáº£m biáº¿n KhÃ­ Gas/KhÃ³i |
| **Active Buzzer** | CÃ²i bÃ¡o Ä‘á»™ng Ã¢m thanh |
| **2 x LEDs** | ÄÃ¨n bÃ¡o tráº¡ng thÃ¡i (Warning/Critical) |
| **Nguá»“n** | 5V DC (Pin dá»± phÃ²ng hoáº·c Adapter) |

## 4. SÆ¡ Ä‘á»“ káº¿t ná»‘i (Pinout)

<img width="799" height="723" alt="Screenshot 2025-12-11 212946" src="https://github.com/user-attachments/assets/ffbd28e2-c769-48f9-8492-d4af095a5c11" />

| Thiáº¿t bá»‹ | ChÃ¢n thiáº¿t bá»‹ | ESP32 GPIO | Giao tiáº¿p |
| :--- | :--- | :--- | :--- |
| **MPU6050** | SDA | 5 | I2C |
| | SCL | 7 | I2C |
| **DHT11** | DATA | 40 | Digital |
| **Gas Sensor**| AO (Analog) | 8 | Analog |
| **Buzzer** | VCC/SIG | 6 | Digital Out |
| **LED 1** | Anode (+) | 35 | Digital Out |
| **LED 2** | Anode (+) | 36 | Digital Out |
| **Button** | BOOT | 0 | Input |

## 5. Pháº§n má»m & CÃ´ng nghá»‡

- **Firmware:** C++ (PlatformIO).
  - Thuáº­t toÃ¡n: Bá»™ lá»c (Filter) Ä‘á»ƒ lÃ m mÆ°á»£t dá»¯ liá»‡u gÃ³c nghiÃªng.
- **Giao thá»©c:** MQTT (truyá»n táº£i JSON payload 1s/láº§n).
- **Backend/Frontend:** Node-RED Dashboard.
- **OTA:** Custom BLE Service.

## 6. Luá»“ng hoáº¡t Ä‘á»™ng (Workflow)

Há»‡ thá»‘ng hoáº¡t Ä‘á»™ng theo chu ká»³ thá»i gian thá»±c (Real-time Loop):

1.  **Thu tháº­p (Sensing):** Äá»c dá»¯ liá»‡u tá»« MPU6050, DHT11, Gas Sensor liÃªn tá»¥c.
2.  **PhÃ¢n tÃ­ch & So sÃ¡nh ngÆ°á»¡ng (Logic):**

    * **Má»©c cáº£nh bÃ¡o (Warning):** ÄÃ¨n LED sÃ¡ng
        - GÃ³c nghiÃªng > `10.0Â°`
        - Äá»™ rung > `0.5 G`
        - KhÃ­ Gas > `300 PPM`
    * **Má»©c nguy hiá»ƒm (Critical):** **CÃ²i Buzzer hÃº + LED nhÃ¡y**
        - GÃ³c nghiÃªng > `15.0Â°` (Nguy cÆ¡ Ä‘á»• sáº­p)
        - Äá»™ rung > `1.0 G`
        - KhÃ­ Gas > `800 PPM` (Nguy cÆ¡ chÃ¡y/ngáº¡t)
    * **GiÃ¡m sÃ¡t BÃª tÃ´ng:**
        - Cáº£nh bÃ¡o náº¿u Nhiá»‡t Ä‘á»™ > `35Â°C` hoáº·c Äá»™ áº©m < `50%`.

3.  **Truyá»n táº£i (Telemetry):**
    - ÄÃ³ng gÃ³i toÃ n bá»™ thÃ´ng sá»‘ vÃ  tráº¡ng thÃ¡i vÃ o JSON.
    - Publish lÃªn MQTT Broker vá»›i chu ká»³ **1 giÃ¢y**.

4.  **Hiá»ƒn thá»‹ & LÆ°u trá»¯ (Server-side):**
    - Node-RED váº½ biá»ƒu Ä‘á»“ theo thá»i gian thá»±c.
    - Tá»± Ä‘á»™ng ghi láº¡i nháº­t kÃ½ (Log History) khi cÃ³ sá»± kiá»‡n Warning/Critical xáº£y ra.

## 7. Giao diá»‡n vÃ  Káº¿t quáº£ Thá»±c nghiá»‡m (Interface & Results)

Há»‡ thá»‘ng cung cáº¥p Dashboard trá»±c quan giÃºp ká»¹ sÆ° giÃ¡m sÃ¡t toÃ n diá»‡n tÃ¬nh tráº¡ng cÃ´ng trÃ¬nh.

1. **Báº£ng Ä‘iá»u khiá»ƒn trung tÃ¢m (Main Dashboard)**
Tá»•ng quan cÃ¡c thÃ´ng sá»‘ quan trá»ng (Rung, NghiÃªng, MÃ´i trÆ°á»ng).
<img width="100%" alt="Main Dashboard" src="https://github.com/user-attachments/assets/e9c22302-a90b-400c-bce4-2877ad6482e3" />

---

2. **GiÃ¡m sÃ¡t tráº¡ng thÃ¡i káº¿t ná»‘i**
Há»‡ thá»‘ng tá»± Ä‘á»™ng bÃ¡o lá»—i khi máº¥t káº¿t ná»‘i WiFi hoáº·c máº¥t nguá»“n thiáº¿t bá»‹.
<p align="center">
  <img width="80%" alt="Connection Lost" src="https://github.com/user-attachments/assets/e6a4d4f8-ec48-4d7c-bba1-2763ecc9f8bf" />
</p>

---

3. **Cáº£nh bÃ¡o an toÃ n (Safety Alert)**
ÄÃ¢y lÃ  tÃ­nh nÄƒng quan trá»ng nháº¥t. Khi cáº£m biáº¿n phÃ¡t hiá»‡n **Chá»‰ sá»‘ vÆ°á»£t ngÆ°á»¡ng an toÃ n** (vÃ­ dá»¥: gÃ³c nghiÃªng > 15Â°, ná»“ng Ä‘á»™ gas > 300 ppm), giao diá»‡n láº­p tá»©c phÃ¡t cáº£nh bÃ¡o, hiá»ƒn thá»‹ vá»‹ trÃ­ vÃ  thÃ´ng sá»‘ vi pháº¡m Ä‘á»ƒ kÃ­ch hoáº¡t quy trÃ¬nh sÆ¡ tÃ¡n hoáº·c kháº¯c phá»¥c.

GÃ³c nghiÃªng > 15Â°
<img width="100%" alt="Tilt Warning" src="https://github.com/user-attachments/assets/fb9d5d69-2bde-4ddf-865b-b82bf597c997" />

---

Ná»“ng Ä‘á»™ gas > 300 ppm
<img width="1880" height="902" alt="Screenshot 2025-12-11 202640" src="https://github.com/user-attachments/assets/4ffa9e6c-f19c-4b82-9454-8329fca0c1c4" />

4. **Chi tiáº¿t thÃ´ng sá»‘ (Detailed Monitoring)**
Thanh Ä‘iá»u hÆ°á»›ng giÃºp truy cáº­p cÃ¡c dá»¯ liá»‡u chuyÃªn sÃ¢u.
<p align="left">
  <img width="250" alt="Navigation Menu" src="https://github.com/user-attachments/assets/16ebfc71-91c7-4e95-9618-ebda086b67ea" />
</p>

* **Tab Sensor:** Theo dÃµi biá»ƒu Ä‘á»“ Nhiá»‡t Ä‘á»™, Äá»™ áº©m, KhÃ­ Gas.
<img width="100%" alt="Sensor Detail" src="https://github.com/user-attachments/assets/34a46ca4-9e8e-4094-b5ef-ed4b118d974a" />

* **Tab Motion:** PhÃ¢n tÃ­ch gÃ³c nghiÃªng (Roll/Pitch) vÃ  Ä‘á»™ rung tá»•ng há»£p.
<img width="100%" alt="Motion Detail" src="https://github.com/user-attachments/assets/a68a5f23-a5f5-4899-87da-aac4eb70c62f" />

* **Tab Alerts** Ä‘Ã³ng vai trÃ² lÃ  trung tÃ¢m Ä‘iá»u hÃ nh vÃ  báº£o trÃ¬ há»‡ thá»‘ng, bao gá»“m 3 chá»©c nÄƒng cá»‘t lÃµi:

* ***Äiá»u khiá»ƒn CÃ²i bÃ¡o (Alarm Control):*** TÃ­nh nÄƒng can thiá»‡p thá»§ cÃ´ng (Manual Override). NgÆ°á»i váº­n hÃ nh cÃ³ thá»ƒ chá»§ Ä‘á»™ng **Báº¬T** cÃ²i (Ä‘á»ƒ diá»…n táº­p sÆ¡ tÃ¡n hoáº·c cáº£nh bÃ¡o kháº©n cáº¥p) hoáº·c **Táº®T** cÃ²i (sau khi Ä‘Ã£ xá»­ lÃ½ xong sá»± cá»‘) trá»±c tiáº¿p tá»« giao diá»‡n web.
* ***Nháº­t kÃ½ Sá»± cá»‘ (Alert History):*** Thay tháº¿ cho tháº» nhá»› váº­t lÃ½, báº£ng nÃ y tá»± Ä‘á»™ng lÆ°u trá»¯ lá»‹ch sá»­ cÃ¡c láº§n vi pháº¡m an toÃ n (Rung/NghiÃªng/Gas) kÃ¨m má»‘c thá»i gian vÃ  má»©c Ä‘á»™ nghiÃªm trá»ng (Severity). GiÃºp ká»¹ sÆ° dá»… dÃ ng truy xuáº¥t dá»¯ liá»‡u quÃ¡ khá»©.
* ***Cáº­p nháº­t Báº£o máº­t (Secure OTA):*** Khu vá»±c náº¡p Firmware tá»« xa Ä‘Æ°á»£c báº£o vá»‡ báº±ng mÃ£ xÃ¡c nháº­n, Ä‘áº£m báº£o chá»‰ ngÆ°á»i cÃ³ tháº©m quyá»n má»›i Ä‘Æ°á»£c phÃ©p can thiá»‡p vÃ o há»‡ thá»‘ng.
  
<img width="1871" height="862" alt="Screenshot 2025-12-12 002051" src="https://github.com/user-attachments/assets/fc957912-fda6-4514-9b80-6e52e7921d8e" />

## 8. HÆ°á»›ng dáº«n OTA (Cáº­p nháº­t tá»« xa)

Há»‡ thá»‘ng Ã¡p dá»¥ng kiáº¿n trÃºc **Dual-Partition** (PhÃ¢n vÃ¹ng Factory & App) giÃºp thiáº¿t bá»‹ khÃ´ng bao giá» bá»‹ há»ng (Anti-brick) ngay cáº£ khi quÃ¡ trÃ¬nh cáº­p nháº­t gáº·p lá»—i.

- **BLE OTA (Quy trÃ¬nh an toÃ n):**
  1. **KÃ­ch hoáº¡t:** Truy cáº­p Dashboard, nháº­p **MÃ£ xÃ¡c nháº­n (Password)** Ä‘á»ƒ thiáº¿t bá»‹ khá»Ÿi Ä‘á»™ng láº¡i vÃ o phÃ¢n vÃ¹ng **Factory Mode** (cháº¿ Ä‘á»™ chá» náº¡p chuyÃªn biá»‡t).
  2. **Náº¡p Firmware:** Sá»­ dá»¥ng á»©ng dá»¥ng `app_ble_v1.py` trÃªn mÃ¡y tÃ­nh Ä‘á»ƒ káº¿t ná»‘i Bluetooth vÃ  gá»­i file firmware `.bin` má»›i.
  3. **HoÃ n táº¥t:** Sau khi nháº­n Ä‘á»§ dá»¯ liá»‡u, há»‡ thá»‘ng tá»± Ä‘á»™ng xÃ¡c thá»±c vÃ  chuyá»ƒn khá»Ÿi Ä‘á»™ng vá» phÃ¢n vÃ¹ng á»¨ng dá»¥ng (Application) má»›i.
